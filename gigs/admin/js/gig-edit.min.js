jQuery(function(e){var t=e("#gig-date"),i=e("#gig-time"),a=e("#gig-venue"),n=e("#gig-venue-timezone-group"),o=e("#gig-venue-timezone"),s=e("#gig-venue-timezone-search"),r=sessionStorage||{},d="lastGigDate"in r?new Date(r.lastGigDate):null,l="lastGigTime"in r?new Date(r.lastGigTime):null;n.pointer({audiothemeId:"at100_gigvenue_tz"}),d&&d.setDate(d.getDate()+1),t.datepicker({dateFormat:"yy/mm/dd",defaultDate:d,showOn:"both",buttonImage:audiothemeGigsL10n.datepickerIcon}),i.timepicker({scrollDefaultTime:l,timeFormat:audiothemeGigsL10n.timeFormat,className:"ui-autocomplete"}).on("showTimepicker",function(){e(this).addClass("open"),e(".ui-timepicker-list").width(e(this).outerWidth())}).on("hideTimepicker",function(){e(this).removeClass("open")}).next().on("click",function(){i.focus()}),e("#publish").on("click",function(){var e=t.datepicker("getDate"),a=i.timepicker("getTime");r&&""!==e&&(r.lastGigDate=e),r&&""!==a&&(r.lastGigTime=a)}),a.autocomplete({change:function(){""!==a.val()?e.ajax({url:ajaxurl,data:{action:"audiotheme_ajax_is_new_venue",name:a.val()},dataType:"json",success:function(e){e.length?n.hide().pointer("close"):n.show().pointer("audiothemeOpen")}}):n.hide().pointer("close")},select:function(){n.hide().pointer("close")},source:ajaxurl+"?action=audiotheme_ajax_get_venue_matches",minLength:0,position:"undefined"!=typeof isRtl&&isRtl?{my:"right top",at:"right bottom",offset:"0, -1"}:{offset:"0, -1"},open:function(){e(this).addClass("open")},close:function(){e(this).removeClass("open")}}),e("#gig-venue-select").on("click",function(){a.focus().autocomplete("search","")}),s.autocomplete({source:function(t,i){e.ajax({url:"http://api.wordpress.org/core/name-to-zoneinfo/1.0/",type:"GET",data:{s:s.val()},dataType:"jsonp",jsonpCallback:"dummyCallback",success:function(t){i(e.map(t,function(e){return{label:e.name+", "+e.location+" - "+e.timezone,value:e.timezone,location:e.location,timezone:e.timezone}}))}})},minLength:2,select:function(e,t){o.find('option[value="'+t.item.timezone+'"]').attr("selected","selected")},position:"undefined"!=typeof isRtl&&isRtl?{my:"right top",at:"right bottom",offset:"0, -1"}:{offset:"0, -1"},open:function(){e(this).addClass("open")},close:function(){e(this).removeClass("open")}})});